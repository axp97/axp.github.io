---
title: 微前端
date: 2021-10-06 17:00:00
author: 安小盼
categories: 前端
tags:
    - 微前端
    - 前端进阶
---

## 目标

- [x] 了解微前端
- [x] 微前端解决方案

## 知识要点

### 一、 微前端基础

#### 0. 铺垫

❗目前前端`SPA`存在的一些问题：

1. 更改了一行 JS 代码，整个项目要重打包编译发布
2. 更换新的技术栈需要重新开发原项目
3. 性能问题：所有的JS到最后都打包到一个`Bundle.js`文件里

❔解决技术/架构：

* 不限技术栈
* 隔离：发版
* 共享数据

主角登场：微前端~

#### 1. 本质

微前端（Micro-Frontends）是一种类似于微服务的架构，它将微服务的理念应用于前端，即将 Web 应用由**单一的单页面**应用转变为**多个小型前端应用聚合为一**的应用。然后各个前端应用还可以**独立运行、独立开发、独立部署**。

#### 2. 方案

##### 1. 路由转发

后台控制路由：将路由跳转交给服务端，当我们访问一个路由的时候，后端进行重定向等操作，这样就会将我们的应用**隔离**开。

隔离JS，css：每次路由匹配到的话，都会进行刷新
信息共享：`cookie`等技术

   >👍优点：简单，可快速配置
   >👎缺点：体验差：每次跳转相当于重新刷新页面，不是页面内进行跳转

##### 2. `iframe`嵌套

通过创建一个父程序，在父程序中监听路由的变化，卸载或加载相应的子程序iframe。因每一个iframe就相当于一个单独的页面，所以iframe具有天然的JS和css隔离。

隔离JS，css：每一个iframe就相当于一个单独的页面
信息共享：postMessage或者contentWindow的方式

   >👍优点：实现起来简单，自带沙盒特性
   >👎缺点：iframe样式兼容问题。分别为功能性兼容性以及业务性兼容性的问题。可能会存在一些安全问题。postmessage可以试出来。
        * 主应用劫持快捷键操作
        * 事件无法冒泡顶层，针对整个应用统一处理时效
        * iframe 内元素会被限制在文档树中，视窗宽高限制问题
        * 无法共享基础库进一步减少包体积
        * [事件通信繁琐且限制多](https://blog.csdn.net/willspace/article/details/49003963)

##### 3. 纯`[web components](https://www.ruanyifeng.com/blog/2019/08/web_components.html)`开发

将每个子应用采用web components进行开发。纯web-components相当于自定义了一个html标签，我们就可以在任何的框架中进行使用此标签。Vue/React组件借鉴的写法了。

   > 👍优点：每个子应用拥有独立的script和css，也可单独部署
   > 👎缺点：需要对之前的子系统都要进行改造，并且通信方面较为复杂

##### 4. 组合式应用路由分发✨

每个子应用单独的打包，部署和运行。不过需要基于父应用进行路由管理。父应用卸载/加载应用。

   > 👍优点：纯前端改造，相比于路由式，无刷新，体验感良好。
   > 👎缺点：需要解决样式冲突，`JS`污染问题，通信技术等

#### 3. 目前采用的方案：组合式应用路由分发

##### 1. css冲突解决方案

1. 类似于`vue`的`scoped`
    打包时对css选择器加上响应的属性，属性的`key`值是一些不重复的`hash`值，然后在选择的时候，使用属性选择器进行选择。
2. 可以自定义前缀
    在开发子模块之前，需要确定一个全局唯一的`css`前缀，然后在书写的过程中同一添加此前缀，或在根`root`上添加此前缀，使用`less`或`sass`作用域嵌套即可解。

##### 2. JS的沙盒环境

js作用域、属性等的隔离

**Pass：**

* 报错：JSON.parse(JSON.stringtify(window))
* 深拷贝：window嵌套window，递归栈溢出

**方案：**

1. `diff`方法：兜底方法。当子页面加载到父类的基座中的时候，生成一个map的散列表。在页面渲染之前，我们先把当前的`window`上的变量等都存储在这个map中。当页面卸载的时候，我们在遍历这个`map`，将其数据在替换回去。


2. 使用代理的形式。`[proxy]（https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy）`：监听`get`和`set`方法，针对当前路由进行window的属性或方法的存取。

3. 其他

* `iframe`自带`css`和`js`沙盒隔离。
* 打快照：类似于Map


### 二、 待更新…

待更新…

## 补充知识点

待更新…

